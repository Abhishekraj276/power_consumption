<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Consumption Predictor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        input[type="number"], input[type="file"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 4px 4px 0 0;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: #2c3e50;
            margin: 0;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #ccc;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
            background-color: white;
        }
        .active-tab {
            display: block;
        }
        .form-columns {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .feature-list {
            font-size: 12px;
            columns: 3;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
        }
        .section-title {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .required-order {
            font-size: 11px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Energy Consumption Predictor</h1>
        
        {% if not model_exists %}
        <div class="warning">
            <strong>Demo Mode:</strong> Model files not found. Using demo data for prediction.
        </div>
        {% endif %}
        
        <div class="info">
            <strong>Model expects {{ feature_count }} features in this exact order:</strong>
            <div class="feature-list">
                {% for feature in feature_names %}
                {{ feature }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </div>
        </div>
        
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'FileUpload')">Upload CSV File</button>
            <button class="tablinks" onclick="openTab(event, 'ManualInput')">Manual Input</button>
        </div>
        
        <div id="FileUpload" class="tabcontent active-tab">
            <h2>Upload CSV File for Prediction</h2>
            <p>CSV must contain these {{ feature_count }} columns in <strong>exact order</strong>:</p>
            <div class="feature-list">
                {% for feature in feature_names %}
                {{ feature }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </div>
            <form action="/predict" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="file">Select CSV File:</label>
                    <input type="file" id="file" name="file" accept=".csv" required>
                </div>
                <button type="submit">Predict</button>
            </form>
        </div>
        
        <div id="ManualInput" class="tabcontent">
            <h2>Enter Key Values (Other features will be auto-generated)</h2>
            <form action="/predict" method="post">
                <div class="form-columns">
                    <div>
                        <div class="section-title">Environmental Factors</div>
                        <div class="form-group">
                            <label for="temperature">Temperature (Â°C):</label>
                            <input type="number" id="temperature" name="temperature" step="0.1" value="22.0" required>
                            <div class="required-order">Feature order: 1</div>
                        </div>
                        <div class="form-group">
                            <label for="humidity">Humidity (%):</label>
                            <input type="number" id="humidity" name="humidity" step="0.1" value="50.0" required>
                            <div class="required-order">Feature order: 2</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="section-title">Building Characteristics</div>
                        <div class="form-group">
                            <label for="square_footage">Square Footage:</label>
                            <input type="number" id="square_footage" name="square_footage" step="1" value="2000" required>
                            <div class="required-order">Feature order: 3</div>
                        </div>
                        <div class="form-group">
                            <label for="occupancy">Occupancy (people):</label>
                            <input type="number" id="occupancy" name="occupancy" step="1" value="3" required>
                            <div class="required-order">Feature order: 4</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="section-title">Usage Patterns</div>
                        <div class="form-group">
                            <label for="hvac_usage">HVAC Usage (kWh):</label>
                            <input type="number" id="hvac_usage" name="hvac_usage" step="0.1" value="15.0" required>
                            <div class="required-order">Feature order: 5</div>
                        </div>
                        <div class="form-group">
                            <label for="lighting_usage">Lighting Usage (kWh):</label>
                            <input type="number" id="lighting_usage" name="lighting_usage" step="0.1" value="8.0" required>
                            <div class="required-order">Feature order: 6</div>
                        </div>
                        <div class="form-group">
                            <label for="renewable_energy">Renewable Energy (kWh):</label>
                            <input type="number" id="renewable_energy" name="renewable_energy" step="0.1" value="5.0" required>
                            <div class="required-order">Feature order: 7</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="section-title">Time Information</div>
                        <div class="form-group">
                            <label for="day_of_week">Day of Week (0-6, 0=Monday):</label>
                            <input type="number" id="day_of_week" name="day_of_week" min="0" max="6" value="{{ now.weekday() }}" required>
                            <div class="required-order">Feature order: 8</div>
                        </div>
                        <div class="form-group">
                            <label for="holiday">Holiday (0=No, 1=Yes):</label>
                            <input type="number" id="holiday" name="holiday" min="0" max="1" value="0" required>
                            <div class="required-order">Feature order: 9</div>
                        </div>
                        <div class="form-group">
                            <label for="hour">Hour (0-23):</label>
                            <input type="number" id="hour" name="hour" min="0" max="23" value="{{ now.hour }}" required>
                            <div class="required-order">Feature order: 10</div>
                        </div>
                        <div class="form-group">
                            <label for="day_of_month">Day of Month (1-31):</label>
                            <input type="number" id="day_of_month" name="day_of_month" min="1" max="31" value="{{ now.day }}" required>
                            <div class="required-order">Feature order: 11</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="section-title">Date Information</div>
                        <div class="form-group">
                            <label for="month">Month (1-12):</label>
                            <input type="number" id="month" name="month" min="1" max="12" value="{{ now.month }}" required>
                            <div class="required-order">Feature order: 12</div>
                        </div>
                        <div class="form-group">
                            <label for="week_of_year">Week of Year (1-52):</label>
                            <input type="number" id="week_of_year" name="week_of_year" min="1" max="52" value="{{ week_of_year }}" required>
                            <div class="required-order">Feature order: 13</div>
                        </div>
                        <div class="form-group">
                            <label for="is_weekend">Is Weekend (0=No, 1=Yes):</label>
                            <input type="number" id="is_weekend" name="is_weekend" min="0" max="1" value="{% if now.weekday() in [5, 6] %}1{% else %}0{% endif %}" required>
                            <div class="required-order">Feature order: 14</div>
                        </div>
                        <div class="form-group">
                            <label for="season">Season (0=Winter, 1=Spring, 2=Summer, 3=Fall):</label>
                            <input type="number" id="season" name="season" min="0" max="3" value="
                                {% if now.month in [12, 1, 2] %}0
                                {% elif now.month in [3, 4, 5] %}1
                                {% elif now.month in [6, 7, 8] %}2
                                {% else %}3{% endif %}
                            " required>
                            <div class="required-order">Feature order: 15</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="section-title">Energy History</div>
                        <div class="form-group">
                            <label for="base_energy">Base Energy (kWh):</label>
                            <input type="number" id="base_energy" name="base_energy" step="0.01" value="100.0" required>
                        </div>
                        <div class="form-group">
                            <label for="energy_lag_24h">Energy 24h ago (kWh):</label>
                            <input type="number" id="energy_lag_24h" name="energy_lag_24h" step="0.01" value="100.0" required>
                            <div class="required-order">Feature order: 16</div>
                        </div>
                        <div class="form-group">
                            <label for="energy_lag_168h">Energy 168h ago (kWh):</label>
                            <input type="number" id="energy_lag_168h" name="energy_lag_168h" step="0.01" value="95.0" required>
                            <div class="required-order">Feature order: 17</div>
                        </div>
                        <div class="form-group">
                            <label for="energy_ma_24h">24h Moving Average (kWh):</label>
                            <input type="number" id="energy_ma_24h" name="energy_ma_24h" step="0.01" value="105.0" required>
                            <div class="required-order">Feature order: 18</div>
                        </div>
                        <div class="form-group">
                            <label for="energy_ma_7d">7-day Moving Average (kWh):</label>
                            <input type="number" id="energy_ma_7d" name="energy_ma_7d" step="0.01" value="102.0" required>
                            <div class="required-order">Feature order: 19</div>
                        </div>
                    </div>
                </div>
                <button type="submit">Predict</button>
            </form>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
   
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            document.getElementById('hour').value = now.getHours();
            document.getElementById('day_of_week').value = now.getDay();
            document.getElementById('day_of_month').value = now.getDate();
            document.getElementById('month').value = now.getMonth() + 1;
        
            const isWeekend = (now.getDay() === 0 || now.getDay() === 6) ? 1 : 0;
            document.getElementById('is_weekend').value = isWeekend;
            
            const month = now.getMonth() + 1;
            let season;
            if (month >= 3 && month <= 5) season = 1; // Spring
            else if (month >= 6 && month <= 8) season = 2; // Summer
            else if (month >= 9 && month <= 11) season = 3; // Fall
            else season = 0; // Winter
            document.getElementById('season').value = season;
        });
    </script>
</body>
</html>